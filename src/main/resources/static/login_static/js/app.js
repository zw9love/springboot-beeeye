"use strict";var key="LPsj",suffix="LPsj",vm=new Vue({el:"#app",data:{loginname:"",passwd:"",token:"",progressStatus:"",step:0,progress_value:0,lock:!1,fullscreenLoading:!1,uploadActive:!1,loadingActive:!1,progressActive:!1,tableData:[],total:100,loading:!1,num:5,hostListActive:!1,role:"",hash:""},methods:{handleSelectionChange:function(t){this.multipleSelection=t},uploadProgress:function(t,o,e){this.progressActive=!0,this.progress_value=parseInt(t.percent)},uploadSuccess:function(t,o,e){var s=this;this.progressStatus="success",this.stopUpload(),swal({type:"success",text:"license文件上传成功，请重新登陆！",background:"#282828",confirmButtonColor:"#666",textColor:"#fff"}).then(function(){s.uploadActive=!1,s.lock=!1})},uploadBefore:function(t){return"license"===t.name?(this.startUpload(),!0):(swal({type:"error",text:"请上传license文件！",background:"#282828",confirmButtonColor:"#666",textColor:"#fff"}),!1)},startUpload:function(){this.loadingActive=!0},stopUpload:function(){this.loadingActive=!1},close:function(){this.lock=!1,this.uploadActive=!1},closeHostList:function(){this.hostListActive=!1},showModal:function(t,o){var e=this,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};swal({type:s.type||"error",text:t,background:"#282828",confirmButtonColor:"#666",textColor:"#fff",showCancelButton:s.showCancelButton,cancelButtonText:s.cancelButtonText||"取消",confirmButtonText:s.confirmButtonText||"确定",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1}).then(function(){o&&o(),setTimeout(function(){e.lock=!1},300)})},showUpload:function(){var t=this;setTimeout(function(){t.loadingActive=!1,t.uploadActive=!0,t.progressActive=!1,t.progressStatus="",t.lock=!0},400),this.loadingActive=!0},showHostList:function(){var n=this;this.getData("/login/findAllHost","",function(t,o,e){var s=t.data;s.data.forEach(function(t){t.web_version=t.os_type+"-"+t.os_version+"-"+t.os_arch}),n.tableData=s.data,n.num=s.num,n.loadingActive=!1,n.hostListActive=!0,n.lock=!0}),this.loadingActive=!0},pageChange:function(t){var o=this;setTimeout(function(){o.loadingActive=!1,o.lock=!0},400),this.loadingActive=!0},delById:function(o){var e=this,s={type:"success"};this.showModal("确定要删除该主机吗?",function(){e.loadingActive=!0,e.getData("/login/deleteHost/"+o.host_ids,"",function(t){e.loadingActive=!1,e.showModal("删除"+o.name+"主机成功!",function(){e.showHostList()},s)})},{type:"info",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"})},getData:function(t,o,s,n){var a=this;$.ajax({url:t,type:"post",contentType:"application/json; charset=UTF-8",data:o,success:function(t,o,e){s(t,o,e)},error:function(t,o,e){n&&n(),a.loadingActive=!1,a.showModal("网络错误！")},dataType:"json"})},login:function(){var n=this;if(!/^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9]).{10,24}$/.test(this.passwd))return this.showModal("密码格式有误！");var t=JSON.stringify({login_name:this.loginname,login_pwd:md5(this.passwd+suffix)});this.lock||(this.lock=!0,this.getData("/login/dologin",t,function(t,o,e){if(t.status)switch(n.token=e.getResponseHeader("token"),t.status){case 200:localStorage.setItem("token",e.getResponseHeader("token"));var s=JSON.stringify({token:e.getResponseHeader("token")});n.getData("/login/loged/",s,function(t){n.role=t.data.role,n.token=e.getResponseHeader("token"),n.$refs.loged.submit()});break;case 400:n.showModal(t.msg,function(){n.hash=t.data,n.showUpload()});break;case 630:n.showModal("license文件过期或点数已超，请联系系统管理员处理！");break;case 700:n.showModal("license文件过期，请重新上传license文件。",function(){n.hash=t.data,n.showUpload()});break;case 701:n.showModal("检测到主机点数不符合要求，请先删除主机。",n.showHostList);break;case 702:n.showModal("主机校验不符，请重新上传license文件。",function(){n.hash=t.data,n.showUpload()});break;default:n.showModal(t.msg)}}))}}});